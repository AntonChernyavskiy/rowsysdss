<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSS Sport System</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <a class="cta" href="/">DSS Sport System</a>
        <nav>
            <ul class="nav__links">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="calendar.html">Calendar</a></li>
                <li><a href="entries.html">Entries</a></li>
                <li><a href="results.html">Results</a></li>
                <li><a href="login_admin.html">Admin page</a></li>
            </ul>
        </nav>
        <p class="menu cta">Menu</p>
    </header>
    <div class="overlay">
        <a class="close">&times;</a>
        <div class="overlay__content">
            <a href="index.html">Dashboard</a>
            <a href="calendar.html">Calendar</a>
            <a href="entries.html">Entries</a>
            <a href="results.html">Results</a>
            <a href="login_admin.html">Admin page</a>
        </div>
    </div>
    <div class="main-content">
        <div class="news" style="width: 44%">
            <h2>Gaidāmie notikumi</h2>
            <ul id="startlists" class="event-list">
            </ul>
        </div>
        <div class="news" style="width: 44%">
            <h2>Iepriekšējie notikumi</h2>
            <ul id="competitions-files" class="event-list">
            </ul>
        </div>
    </div>

    <!-- Registration Form Modal -->
    <div id="registration-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Registration Form</h2>
            <div id="registration-form-container">
                <!-- Здесь будет загружаться содержимое формы -->
            </div>
        </div>
    </div>

    <script src="filter.js"></script>
    <script src="mobile.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch('/files')
                .then(response => response.json())
                .then(data => {
                    const startlistsContainer = document.getElementById('startlists');
                    const competitionsContainer = document.getElementById('competitions-files');

                    const upcomingEvents = [];
                    const pastEvents = [];

                    data.forEach(entry => {
                        const [date, eventName] = entry.split('  ');
                        const event = { date: date, name: eventName };
                        if (new Date(date) >= new Date()) {
                            upcomingEvents.push(event);
                        } else {
                            pastEvents.push(event);
                        }
                    });

                    function createEventListItem(event, container) {
                        const li = document.createElement('li');
                        const div = document.createElement('div');
                        div.classList.add('event-details');

                        const h3 = document.createElement('h3');
                        h3.textContent = event.name;

                        const p = document.createElement('p');
                        p.classList.add('event-dates');
                        p.textContent = event.date;

                        const divButtons = document.createElement('div');
                        divButtons.classList.add('event-buttons');

                        const resultBtn = document.createElement('a');
                        resultBtn.classList.add('event-btn');
                        resultBtn.href = 'results.html';
                        resultBtn.textContent = 'Rezultāti';
                        resultBtn.setAttribute('data-event', event.name);

                        const registerBtn = document.createElement('a');
                        registerBtn.classList.add('event-btn');
                        registerBtn.href = '#';
                        registerBtn.textContent = 'Pieteikties';
                        registerBtn.setAttribute('data-event', event.name);
                        registerBtn.setAttribute('data-date', event.date);
                        registerBtn.classList.add('register-btn');

                        divButtons.appendChild(resultBtn);
                        divButtons.appendChild(registerBtn);

                        div.appendChild(h3);
                        div.appendChild(p);
                        div.appendChild(divButtons);

                        li.appendChild(div);
                        container.appendChild(li);
                    }

                    upcomingEvents.forEach(event => createEventListItem(event, startlistsContainer));
                    pastEvents.forEach(event => createEventListItem(event, competitionsContainer));

                    function fetchAndDisplayRegistrationForm(eventName, eventDate) {
                        fetch(`/entrySys/${eventDate}%20%20${eventName}/config.txt`)
                            .then(response => response.json())
                            .then(config => {
                                // Вставляем содержимое формы регистрации
                                const formContent = `
                                    <!-- Здесь вставляем содержимое registration-form.html -->
                                    ${config.html}
                                `;
                                document.getElementById('registration-form-container').innerHTML = formContent;

                                document.getElementById('registration-modal').style.display = 'block';
                            })
                            .catch(error => console.error('Error loading registration form:', error));
                    }

                    document.querySelector('.close-modal').addEventListener('click', function () {
                        document.getElementById('registration-modal').style.display = 'none';
                    });

                    document.addEventListener('click', function (event) {
                        if (event.target && event.target.classList.contains('register-btn')) {
                            event.preventDefault();
                            const eventName = event.target.getAttribute('data-event');
                            const eventDate = event.target.getAttribute('data-date');
                            fetchAndDisplayRegistrationForm(eventName, eventDate);
                        }
                    });
                })
                .catch(error => console.error('Error loading files:', error));
        });
    </script>
</body>
</html>
